<!DOCTYPE html>
<html lang="zh_cn">

<head>
    {% include 'head.html' %}
    <script>
        function user_exit(session_id) {
            $.ajax({
                "url": "/api/v1/user/logout",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/json",
                    "X-Session-ID": session_id
                }
            }).done((response) => {
                console.log(response);
            });
        }
        function uploadFile() {
            var formData = new FormData();
            formData.append('file', $('#fileInput')[0].files[0]);
        
            $.ajax({
              url: '/api/v1/files/upload',
              method: 'POST',
              headers: {
                'X-Session-ID': $.cookie("session_id")
              },
              data: formData,
              processData: false,
              contentType: false
            }).done((response) => {
              console.log(response);
            });
        }
    </script>
</head>

<body>
<div class="app">
    <div class="flex flex-col items-end w-full">
      <div class="ui icon top right pointing dropdown button">
        <i class="user circle icon"></i>
        <div class="menu">
          <div id="display_username" class="header hidden"></div>
          <div id="login_button" class="item">登录</div>
          <div id="exit_button" class="item">退出</div>
          <script>
            $("#login_button")[0].addEventListener("click",  ()=> {
              window.location.href = "/login"
            });
            $("#exit_button")[0].addEventListener("click", () =>{
              user_exit($.cookie(''));
              $.removeCookie('uid');
              $.removeCookie('session_id');
              window.location.href = "/"
            })
          </script>
        </div>
      </div>
    </div>
    <div class="flex flex-col flex-grow justify-center items-center">
        <img class="w-1/3 md:w-1/5 mb-8" src="/static/favicon/favicon.png" alt="FileDock"/>
        <button class="massive ui button blue w-1/2 md:w-2/5 text-xl">
            上传
        </button>
        <div id="upload_modal" class="ui modal">
          <div class="header">
            <i aria-hidden="true" class="close icon"></i>
          </div>
          <div class="content">
            <input type="file" id="fileInput">
          </div>
        </div>
        <script>
          $('#upload_modal').modal('show');
        </script>   
        <button class="massive ui button w-1/2 md:w-2/5 text-xl">
            接收
        </button>
    </div>
    <div class="flex flex-col items-end w-full">
        {% include 'footer.html' %}
    </div>
</div>
<script>
    $('.ui.dropdown')
        .dropdown()
    ;

    function display_username() {
        disname_obj = $('#display_username')[0];
        disname_obj.classList.remove('hidden');
        disname_obj.classList.add('font-bold');
        $.ajax({
            "url": "/api/v1/user/info",
            "method": "POST",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json"
            },
            "data": JSON.stringify({
                "uid": $.cookie('uid')
            }),
        }).done(function (response) {
            if (response.success) {
                console.log(response)
                $("#display_username")[0].innerText = response.data.username;
            }
        });
    }

    session_id = $.cookie('session_id');
    if (session_id) {
        $.ajax({
            "url": "/api/v1/session/verify",
            "method": "GET",
            "timeout": 0,
            "headers": {
                "Content-Type": "application/json",
                "X-Session-ID": session_id
            }
        }).done((response) => {
            if (response.success) {
                $('#login_button')[0].classList.add('hidden');
                display_username();
            }
        });
    }
</script>
</body>

</html>