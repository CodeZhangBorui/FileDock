<!DOCTYPE html>
<html lang="zh_cn">

<head>
  {% include 'head.html' %}
  <script>
    function user_exit(session_id) {
      var settings = {
        "url": "/api/v1/user/logout",
        "method": "POST",
        "timeout": 0,
        "headers": {
            "Content-Type": "application/json"
        },
        "data": JSON.stringify({
            "session_id": session_id
        }),
      };

      $.ajax(settings).done(function (response) {
        console.log(response);
      });
    }
  </script>
</head>

<body>
  <div class="app">
    <div class="flex flex-col items-end w-full">
      <div class="ui icon top right pointing dropdown button">
        <i class="user circle icon"></i>
        <div class="menu">
          <div id="display_username" class="header hidden"></div>
          <div id="login_button" class="item">登录</div>
          <div id="exit_button" class="item">退出</div>
          <script>
            $("#login_button")[0].addEventListener("click", function () {
              window.location.href = "/login"
            });
            $("#exit_button")[0].addEventListener("click", function() {
              user_exit($.cookie(''));
              $.removeCookie('uid');
              $.removeCookie('session_id');
              window.location.href = "/"
            })
          </script>
        </div>
      </div>
    </div>
    <div class="flex flex-col flex-grow justify-center items-center">
      <img class="w-1/3 md:w-1/5 mb-8" src="/static/favicon/favicon.png" alt="FileDock" />
      <button class="massive ui button blue w-1/2 md:w-2/5">
        <p class="text-xl">上传</p>
      </button>
      <button class="massive ui button w-1/2 md:w-2/5">
        <p class="text-xl">接收</p>
      </button>
    </div>
    <div class="flex flex-col items-end w-full">
      {% include 'footer.html' %}
    </div>
  </div>
  <script>
    $('.ui.dropdown')
      .dropdown()
      ;
    function display_username() {
      $('#display_username')[0].classList.remove('hidden');
      $('#display_username')[0].classList.add('font-bold');
      $.ajax({
        "url": "/api/v1/user/info",
        "method": "POST",
        "timeout": 0,
        "headers": {
          "Content-Type": "application/json"
        },
        "data": JSON.stringify({
          "uid": $.cookie('uid')
        }),
      }).done(function (response) {
        if (response.success) {
          console.log(response)
          $("#display_username")[0].innerText = response.data.username;
        }
      });
    }
    session_id = $.cookie('session_id');
    if (session_id) {
      $.ajax({
        "url": "/api/v1/session/verify",
        "method": "POST",
        "timeout": 0,
        "headers": {
          "Content-Type": "application/json"
        },
        "data": JSON.stringify({
          "session_id": session_id
        }),
      }).done(function (response) {
        if (response.success) {
          $('#login_button')[0].classList.add('hidden');
          display_username();
        }
      });
    }
  </script>
</body>

</html>